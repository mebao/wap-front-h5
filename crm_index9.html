<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <!-- Meta, title, CSS, favicons, etc. -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>crm</title>

    <!-- Bootstrap -->
    <link href="./vendors/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="./vendors/font-awesome/css/font-awesome.min.css" rel="stylesheet">
    <!-- NProgress -->
    <link href="./vendors/nprogress/nprogress.css" rel="stylesheet">
    <!-- FullCalendar -->
    <link href="./vendors/fullcalendar/fullcalendar.min.css" rel="stylesheet">
    <link href="./vendors/fullcalendar/fullcalendar.print.css" rel="stylesheet" media="print">

    <!-- Custom Theme Style -->
    <link href="css/crm.css" rel="stylesheet">
    <link href="css/common.css" rel="stylesheet">
    <link href="css/crmPage.css" rel="stylesheet">
  </head>

  <body class="nav-md">
    <div id="crm" class="container body">
      <div class="main_container">
        <div class="col-md-3 left_col">
          <div class="left_col scroll-view">
            <!-- menu profile quick info -->
            <div class="profile clearfix">
              <div class="profile_pic">
                <img src="images/img.jpg" alt="..." class="img-circle profile_img">
              </div>
              <div class="profile_info">
                <span>Welcome,</span>
                <h2>John Doe</h2>
              </div>
            </div>
            <!-- /menu profile quick info -->

            <br />

            <!-- sidebar menu -->
            <div id="sidebar-menu" class="main_menu_side hidden-print main_menu">
                
              <div class="menu_section">
                
              </div>
            </div>
            <!-- /sidebar menu -->
          </div>
        </div>

        <!-- top navigation -->
        <div class="top_nav">
          <div class="nav_menu">
            <nav>
              <div class="nav toggle">
                <a id="menu_toggle"><i class="fa fa-bars"></i></a>
              </div>

              <ul class="nav navbar-nav navbar-right">
                <li class="">
                  <a href="javascript:;" class="user-profile dropdown-toggle" data-toggle="dropdown" aria-expanded="false">
                    <img src="images/img.jpg" alt="">John Doe
                    <span class=" fa fa-angle-down"></span>
                  </a>
                  <ul class="dropdown-menu dropdown-usermenu pull-right">
                    <li><a href="javascript:;"> Profile</a></li>
                    <li>
                      <a href="javascript:;">
                        <span class="badge bg-red pull-right">50%</span>
                        <span>Settings</span>
                      </a>
                    </li>
                    <li><a href="javascript:;">Help</a></li>
                    <li><a href="login.html"><i class="fa fa-sign-out pull-right"></i> Log Out</a></li>
                  </ul>
                </li>

                <li role="presentation" class="dropdown">
                  <a href="javascript:;" class="dropdown-toggle info-number" data-toggle="dropdown" aria-expanded="false">
                    <i class="fa fa-envelope-o"></i>
                    <span class="badge bg-green">6</span>
                  </a>
                  <ul id="menu1" class="dropdown-menu list-unstyled msg_list" role="menu">
                    <li>
                      <a>
                        <span class="image"><img src="images/img.jpg" alt="Profile Image" /></span>
                        <span>
                          <span>John Smith</span>
                          <span class="time">3 mins ago</span>
                        </span>
                        <span class="message">
                          Film festivals used to be do-or-die moments for movie makers. They were where...
                        </span>
                      </a>
                    </li>
                    <li>
                      <div class="text-center">
                        <a>
                          <strong>See All Alerts</strong>
                          <i class="fa fa-angle-right"></i>
                        </a>
                      </div>
                    </li>
                  </ul>
                </li>
              </ul>
            </nav>
          </div>
        </div>
        <!-- /top navigation -->

        <!-- page content -->
        <div class="right_col index9_page" role="main">
          <div class="x_panel">
            <div class="x_title">
              <h2>预约</h2>
              <div class="clearfix"></div>
            </div>
            <div class="x_content">
              <div>
                <ul class="nav nav-tabs" role="tablist">
                  <li role="presentation" class="active"><a href="#home" aria-controls="home" role="tab" data-toggle="tab">预约管理</a></li>
                  <li role="presentation"><a href="#profile" aria-controls="profile" role="tab" data-toggle="tab">预约设置</a></li>
                </ul>
                <div class="tab-content">
                  <div role="tabpanel" class="tab-pane active" id="home">
                      <div class="flex mt10 search-tab">
                        <a href="crm_index2.html" class="btn btn-success">新增预约</a>
                        <button id="calendarBtn" class="btn btn-success">日历</button>
                        <button id="listBtn" class="btn btn-success">列表</button>
                        <div class="flex-1"></div>
                        <select class="form-control w100p mr10">
                          <option value="">预约类型</option>
                          <option value="1">已收费</option>
                          <option value="2">未收费</option>
                        </select>
                        <input class="form-control w100p mr10" placeholder="选择科室">
                        <select class="form-control w100p mr10">
                          <option value="">选择医生</option>
                          <option value="1">已收费</option>
                          <option value="2">未收费</option>
                        </select>
                        <button type="button" class="btn btn-default"><i class="fa fa-search"></i></button>
                      </div>
                      <div id="calendarTab">
                        <div id='calendarWeek'></div>
                      </div>
                      <div id="listTab">
                        <div class="row mt20">
                          <div class="col-md-4">
                            <div class="info-tab">
                              <div class="flex info">
                                <div class="">
                                  <img src="">
                                </div>
                                <div class="flex-1">
                                  <div>小明</div>
                                  <div>就诊类型：出诊</div>
                                  <div>登记科室：小儿推拿</div>
                                  <div>接诊医生：水电费</div>
                                  <div>登记人员：大幅度</div>
                                  <div>登记时间：12313213132</div>
                                </div>
                              </div>
                              <div class="text-center">
                                查看
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                  </div>
                  <div role="tabpanel" class="tab-pane" id="profile">
                    <div class='mt10'>
                      <div class="flex">
                        <div class="w40">
                          <button id="prevMonth" class="btn btn-default">上一月</button>
                          <button id="nextMonth" class="btn btn-default">下一月</button>
                          <button id="todayMonth" class="btn btn-default">本月</button>
                          <button class="btn btn-default">批量设置</button>
                        </div>
                        <div id="dateInfo" class="w20 text-center"></div>
                        <div class="flex-1"></div>
                        <div class="btn-group">
                          <button class="btn btn-default" type="button">按周设置</button>
                          <button class="btn btn-default" type="button">按月设置</button>
                        </div>
                        <button id="todayMonth" class="btn btn-default ml10">复制上月</button>
                      </div>
                      <table id="infoTab" class="table table-striped table-bordered mb0">
                        
                      </table>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- /page content -->

        <!-- footer content -->
        <footer>
          <div class="pull-right">
            crm
          </div>
          <div class="clearfix"></div>
        </footer>
        <!-- /footer content -->
      </div>
    </div>

    <!-- jQuery -->
    <script src="./vendors/jquery/jquery.min.js"></script>
    <!-- Bootstrap -->
    <script src="./vendors/bootstrap/js/bootstrap.min.js"></script>
    <!-- FastClick -->
    <script src="./vendors/fastclick/fastclick.js"></script>
    <!-- NProgress -->
    <script src="./vendors/nprogress/nprogress.js"></script>
    <!-- FullCalendar -->
    <script src="./vendors/moment/moment.min.js"></script>
    <script src="./vendors/fullcalendar/fullcalendar.min.js"></script>

    <!-- Custom Theme Scripts -->
    <script src="js/crm.js"></script>
    <script src="js/main.js"></script>
    <!-- FullCalendar -->
    <script>
      $(window).load(function() {
        var todayDate = new Date(),
            d = todayDate.getDate(),
            m = todayDate.getMonth(),
            y = todayDate.getFullYear(),
            weekDay = todayDate.getDay(),
            nowDate = new Date(),
            started,
            categoryClass;

        var calendarWeek = $('#calendarWeek').fullCalendar({
          height: 'auto',
          defaultView: 'agendaWeek',
          header: {
            left: 'prev,next today',
            right: ''
          },
          allDayText: '预约',
          slotDuration: '00:30:00',
          slotLabelFormat: 'H:mm',
          slotLabelInterval: '00:30:00',
          minTime: '08:00:00',
          maxTime: '22:30:00',
          titleFormat: {
            month: 'YYYY年MM月',
            week: 'YYYY年MM月DD日',
            day: 'YYYY年MM月DD日 dddd'
          },
          buttonText: {
            prev: '‹上一周',
            next: '下一周›',
            today: '今天',
          },
          dayNames: [
            '星期天',
            '星期一',
            '星期二',
            '星期三',
            '星期四',
            '星期五',
            '星期六',
          ],
          dayNamesShort: [
            '周日',
            '周一',
            '周二',
            '周三',
            '周四',
            '周五',
            '周六',
          ],
          events: [{
            title: 'All Day Event',
            start: new Date(y, m, 1)
          }, {
            title: 'Long Event',
            start: new Date(y, m, d - 5),
            end: new Date(y, m, d - 2)
          }, {
            title: 'Meeting',
            start: new Date(y, m, d, 10, 30),
            allDay: false
          }, {
            title: 'Lunch',
            start: new Date(y, m, d + 14, 12, 0),
            end: new Date(y, m, d, 14, 0),
            allDay: false
          }, {
            title: 'Birthday Party',
            start: new Date(y, m, d + 1, 19, 0),
            end: new Date(y, m, d + 1, 22, 30),
            allDay: false
          }, {
            title: 'Click for Google',
            start: new Date(y, m, 28),
            end: new Date(y, m, 29),
            url: 'http://google.com/'
          }]
        });

        $('#calendarBtn').click(function(){
          $('#listTab').addClass('hidden');
          $('#calendarTab').removeClass('hidden');
        });

        $('#listBtn').click(function(){
          $('#calendarTab').addClass('hidden');
          $('#listTab').removeClass('hidden');
        });

        $prevMonth = $('#prevMonth');
        $nextMonth = $('#nextMonth');
        $todayMonth = $('#todayMonth');
        $prevMonth.click(function(){
          //获取本月第一天
          var monthFirstDay = nowDate.getFullYear() + '-' + (nowDate.getMonth() + 1) + '-1';
          //获取上月最后一天
          var prevMonthDate = new Date(new Date(monthFirstDay).getTime() - 24 * 60 * 60 * 100);
          nowDate = new Date(nowDate.getTime() - (getDayNum(prevMonthDate) * 24 * 60 * 60 * 1000));
          readyPage(nowDate);
        });

        $nextMonth.click(function(){
          //获取下周同一时间
          nowDate = new Date(nowDate.getTime() + (getDayNum(nowDate) * 24 * 60 * 60 * 1000));
          readyPage(nowDate);
        });

        $todayMonth.click(function(){
          //获取下周同一时间
          nowDate = todayDate;
          readyPage(todayDate);
        });

        readyPage(todayDate);

        function readyPage(todayDate){
          var firstDate = getWeekDays(todayDate);
          var yearInfo = firstDate.getFullYear();
          var monthInfo = firstDate.getMonth() + 1;
          var monthDays = getDayNum(firstDate);
          var dMYInfo = '';
          var html = '<thead>\
                        <tr>\
                          <th>日期</th>\
                          <th>儿科</th>\
                          <th>检验科</th>\
                          <th>儿童保健</th>\
                        </tr>\
                      </thead>\
                      <tbody id="tableData">';
          for(var i = 1; i <= monthDays; i++){
            dMYInfo = yearInfo + '-' + (monthInfo > 9 ? monthInfo : ('0' + monthInfo)) + '-' + (i > 9 ? i : ('0' + i));
            html += '<tr>\
                      <td>' + dMYInfo + '  ' +  getDayByDate(dMYInfo) + '</td>\
                      <td>占</td>\
                      <td></td>\
                      <td></td>\
                    </tr>';
          }
                        
          html += '</tbody>';
          $('#dateInfo').html();
          $('#infoTab').html(html);
        }

        //获取本月第一天
        function getWeekDays(date){
          //获取本周周一时间
          var dateTime = date.getTime();
          var firstDate = new Date(dateTime - ((date.getDate() - 1) * 24 * 60 * 60 * 1000));
          return firstDate;
        }
        getDayByDate();

        //通过时间获取星期几
        function getDayByDate(dMYInfo){
          var weekDay = new Date(dMYInfo).getDate();
          if(weekDay % 7 == 0){
            return '周日';
          }else if(weekDay % 7 == 1){
            return '周一';
          }else if(weekDay % 7 == 2){
            return '周二';
          }else if(weekDay % 7 == 3){
            return '周三';
          }else if(weekDay % 7 == 4){
            return '周四';
          }else if(weekDay % 7 == 5){
            return '周五';
          }else if(weekDay % 7 == 6){
            return '周六';
          }
        }

        //返回当月的天数
        function getDayNum(date){
          var m = date.getMonth(),
          y = date.getFullYear(),
          dayNum = 0;

          if(((m + 1) == 1) || ((m + 1) == 3) || ((m + 1) == 5) || ((m + 1) == 7) || ((m + 1) == 8) || ((m + 1) == 10) || ((m + 1) == 12)){
            dayNum = 31;
          }else if((m + 1) == 2){
            if((y % 4) == 0){
              dayNum = 29;
            }else{
              dayNum = 28;
            }
          }else{
            dayNum = 30;
          }

          return dayNum;
        }
      });
    </script>
    <!-- /FullCalendar -->
  </body>
</html>
